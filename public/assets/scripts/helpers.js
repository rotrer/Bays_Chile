function addNotifBay(id,title,message,json,dateNotf){var dataNotif={id:id,title:title,message:message,autoCancel:!0};null!==json&&(dataNotif.json=json),null!==dateNotf&&(dataNotif.date=dateNotf),window.plugin.notification.local.add(dataNotif)}function setNotifMoonPhase(state){if(state===!0)for(var now=new Date,yearCurrent=now.getFullYear(),monthCurrent=now.getMonth(),monthCurrentAdd1=monthCurrent+1,dayCurrent=now.getDate(),qtyDaysCurrentMmonth=new Date(yearCurrent,monthCurrentAdd1,0).getDate(),notificationsMoon={nm:[],fq:[],fm:[],lq:[]},moonPhase={nm:["Luna Nueva","nueva"],fq:["Cuarto Creciente","creciente"],fm:["Luna Llena","llena"],lq:["Cuarto Menguante","menguante"]},fixMonth={m1:0,m2:1,m3:0,m4:1,m5:2,m6:3,m7:4,m8:5,m9:6,m10:7,m11:8,m12:9},nroAureo=(parseInt(yearCurrent)+1)%19,epacta=99*(nroAureo-1),i=dayCurrent;qtyDaysCurrentMmonth>=i;i++){var edadLunar=epacta+parseInt(fixMonth["m"+monthCurrentAdd1])+i,moonPhaseDay="moon_";if(edadLunar>30&&(edadLunar-=30),dayCurrent!==i)var cambioStr="Cambio de fase lunar",cicloStr="Hoy comienza el ciclo de ",dateNotif=new Date(yearCurrent,monthCurrent,i,8,0);else var cambioStr="Fase lunar actual",cicloStr="Ciclo de ",nowTmp=(new Date).getTime(),dateNotif=new Date(nowTmp+3e5);edadLunar>=0&&6>=edadLunar?0===notificationsMoon.nm.length&&(moonPhaseDay+=moonPhase.nm[1],notificationsMoon.nm.push(moonPhaseDay),addNotifBay(moonPhaseDay,cambioStr,cicloStr+moonPhase.nm[0],null,dateNotif)):edadLunar>=7&&13>=edadLunar?0===notificationsMoon.fq.length&&(moonPhaseDay+=moonPhase.fq[1],notificationsMoon.fq.push(moonPhaseDay),addNotifBay(moonPhaseDay,cambioStr,cicloStr+moonPhase.fq[0],null,dateNotif)):edadLunar>=14&&21>=edadLunar?0===notificationsMoon.fm.length&&(moonPhaseDay+=moonPhase.fm[1],notificationsMoon.fm.push(moonPhaseDay),addNotifBay(moonPhaseDay,cambioStr,cicloStr+moonPhase.fm[0],null,dateNotif)):edadLunar>=22&&0===notificationsMoon.lq.length&&(moonPhaseDay+=moonPhase.lq[1],notificationsMoon.lq.push(moonPhaseDay),addNotifBay(moonPhaseDay,cambioStr,cicloStr+moonPhase.lq[0],null,dateNotif))}else deleteNotifMoonPhase()}function deleteNotifMoonPhase(){window.plugin.notification.local.getScheduledIds(function(scheduledIds){angular.forEach(scheduledIds,function(val){-1!==val.indexOf("moon_")&&cancelNotifByID(val)})})}function setNotifBaysWeekend(bayId,bayName){for(var now=new Date,yearCurrent=now.getFullYear(),monthCurrent=now.getMonth(),monthCurrentAdd1=monthCurrent+1,dayCurrent=now.getDate(),qtyDaysCurrentMmonth=new Date(yearCurrent,monthCurrentAdd1,0).getDate(),notifNameWeekend="",i=dayCurrent;qtyDaysCurrentMmonth>=i;i++){var dayCurrentMonth=new Date(yearCurrent,monthCurrent,i),isWeekend=6===dayCurrentMonth.getDay()||0===dayCurrentMonth.getDay();if(isWeekend===!0){notifNameWeekend="bay_"+bayId+"_"+i+"_"+monthCurrent;var diaNombre="";diaNombre=6===dayCurrentMonth.getDay()?"Sábado":"Domingo";var titleNotifWeekend="Mareas Chile.",messageNotifWeekend="Revisa las mareas para mañana "+diaNombre+", en la localidad de "+bayName.toUpperCase(),dataNotif=JSON.stringify({type:"weekend",bay:bayId,day:i,month:monthCurrent}),dateOffset=216e5,dateNotif=new Date(yearCurrent,monthCurrent,i);dateNotif.setTime(dateNotif.getTime()-dateOffset),addNotifBay(notifNameWeekend,titleNotifWeekend,messageNotifWeekend,dataNotif,dateNotif)}}}function deleteAllNotifWeekend(){window.plugin.notification.local.getScheduledIds(function(scheduledIds){angular.forEach(scheduledIds,function(val){-1!==val.indexOf("bay_")&&cancelNotifByID(val)})})}function deleteNotifWeekendByBay(bayId){window.plugin.notification.local.getScheduledIds(function(scheduledIds){angular.forEach(scheduledIds,function(val){-1!==val.indexOf(bayId)&&cancelNotifByID(val)})})}function cancelNotifByID(id){window.plugin.notification.local.cancel(id)}function notifScheduledLog(){window.plugin.notification.local.getScheduledIds(function(scheduledIds){console.log("Scheduled IDs: "+scheduledIds.join(" ,"))})}function initGA(){analytics.trackEvent("App","Open","App",new Date),$(document).on("click",".baySelect",function(){var bayName=$(this).text().trim();analytics.trackView("bay/"+bayName)}),$(document).on("click",".baySelectFavs",function(){$(this).text().trim()}),$(document).on("click","#navHome",function(){analytics.trackView("/home")}),$(document).on("click","#navFavs",function(){analytics.trackView("/favorites")}),$(document).on("click","#navConf",function(){analytics.trackView("/settings")}),$(document).on("click",".moonPhaseNotif",function(){analytics.trackEvent("Button","Click","Toggle notif moon phase",new Date)}),$(document).on("click",".weekendNotif",function(){analytics.trackEvent("Button","Click","Toggle notif weekend",new Date)}),$(document).on("click",".notifBaySel",function(){analytics.trackEvent("Button","Click","Toggle notif weekend bay",new Date)})}Array.prototype.remove=function(){for(var what,ax,a=arguments,L=a.length;L&&this.length;)for(what=a[--L];-1!==(ax=this.indexOf(what));)this.splice(ax,1);return this},document.addEventListener("deviceready",function(){StatusBar.overlaysWebView(!1),StatusBar.backgroundColorByName("gray");var analyticsAccount="UA-34567136-3";analytics.startTrackerWithId(analyticsAccount),initGA(),ons.ready(function(){window.plugin.notification.local.onclick=function(id,state,json){var dataNotif=JSON.parse(json);"weekend"===dataNotif.type&&(null!==dataNotif.bay?($("#loadingApp").show(),localStorage.setItem("currentBay",dataNotif.bay),ons.navigator.pushPage("partials/bay.html")):alert("Error: Bahía no existe."))}})},!1);